/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var e,k=function(a){return a.replace(/^\s+|\s+$/g,"")},t=function(a){if(a&&a.tagName){var b=a.tagName.toLowerCase();if("input"===b||"textarea"===b)return!0}if(document.designMode&&"on"===document.designMode.toLowerCase())return!0;for(;a;a=a.parentNode)if(a.isContentEditable)return!0;return!1},u=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){var d=null;200===c.status&&(d=c.response);return b(d)};c.send()},v=/[0-9A-Za-z]/,y=function(){u(chrome.runtime.getURL("content.min.css"),
function(a){var b=function(c){this.K=c.instanceId;this.J=a;c=document.createElement("div");var d=document.createElement("a");d.target="_blank";this.F=c.cloneNode(!1);this.B=document.createElement("audio");this.B.preload=!0;this.g=c.cloneNode(!1);this.g.id="gdx-bubble-host";this.D=this.g.attachShadow({mode:"open"});var g=document.createElement("style");g.innerHTML=this.J;this.D.appendChild(g);this.a=c.cloneNode(!1);this.a.id="gdx-bubble-main";this.D.appendChild(this.a);this.f=c.cloneNode(!1);this.f.id=
"gdx-bubble-query-row";this.C=c.cloneNode(!1);this.C.id="gdx-bubble-query";this.i=c.cloneNode(!1);this.i.id="gdx-bubble-audio-icon";this.f.appendChild(this.C);this.f.appendChild(this.i);this.l=c.cloneNode(!1);this.l.id="gdx-bubble-meaning";this.c=c.cloneNode(!1);this.c.id="gdx-bubble-options-tip";this.c.innerHTML='Tip: Didn\'t want this definition pop-up? Try setting a trigger key in <a href="#">Extension Options</a>.';this.m=c.cloneNode(!1);this.m.id="gdx-bubble-more";this.h=d.cloneNode(!1);this.m.appendChild(this.h);
this.b=c.cloneNode(!1);this.b.id="gdx-bubble-attribution";this.s=d.cloneNode(!1);this.v=c.cloneNode(!1);this.b.appendChild(this.s);this.b.appendChild(this.v);this.w=c.cloneNode(!1);this.w.id="gdx-bubble-close";this.a.appendChild(this.w);this.a.appendChild(this.f);this.a.appendChild(this.l);this.a.appendChild(this.c);this.a.appendChild(this.b);this.a.appendChild(this.m);this.A=c.cloneNode(!1);this.D.appendChild(this.A);this.I=w(c,"up");this.H=w(c,"down");x(this)}.bind(this);chrome.runtime.sendMessage({type:"initialize"},
b)}.bind(this))},z=[];e=y.prototype;e.J="";e.u=0;e.F=null;e.B=null;e.g=null;e.D=null;e.a=null;e.f=null;e.C=null;e.i=null;e.l=null;e.c=null;e.w=null;e.m=null;e.h=null;e.b=null;e.s=null;e.v=null;e.A=null;e.I=null;e.H=null;e.o=null;e.G=null;
var x=function(a){a.G=a.N.bind(a);window.addEventListener("resize",a.j.bind(a));document.addEventListener("mouseup",a.P.bind(a));document.addEventListener("dblclick",a.L.bind(a));document.addEventListener("keydown",a.O.bind(a));a.w.onclick=a.j.bind(a);a.i.onclick=function(){this.B.play()}.bind(a);a.c.querySelector("a").onclick=function(){chrome.runtime.sendMessage({type:"openOptionsPage"},function(){});return!1};var b=function(c){c.preventDefault();c.stopPropagation()};a.i.onmousedown=b;a.w.onmousedown=
b;chrome.runtime.onMessage.addListener(D);chrome.runtime.onMessage.addListener(a.G)},w=function(a,b){var c=a.cloneNode(!1),d=a.cloneNode(!1);a=a.cloneNode(!1);c.id="gdx-arrow-main";"up"===b?(d.id="gdx-bubble-arrow-inner-up",a.id="gdx-bubble-arrow-outer-up"):(d.id="gdx-bubble-arrow-inner-down",a.id="gdx-bubble-arrow-outer-down");c.appendChild(d);c.appendChild(a);return c},E=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d},F=function(a){a.a.style.left="0";a.a.style.top="0";var b=
a.a.offsetWidth,c=a.a.offsetHeight,d=[window.pageXOffset,window.pageYOffset],g=d[0],f=[a.o.left+g,a.o.top+d[1]],n=a.o.bottom-a.o.top,A=f[0]+(a.o.right-a.o.left)/2;d=g+document.documentElement.offsetWidth;var l=A-b/2;l+b>d&&(l=d-b);l<g&&(l=g);var r=f[1]-c-12+1,m=f[1]+n+12-1;a:if(b=new E(r,l+b,r+c,l),b.top<window.pageYOffset)b=!1;else{c=document.getElementsByTagName("embed");var B=document.getElementsByTagName("object"),p=[window.pageXOffset,window.pageYOffset],C=p[0];p=p[1];for(var q=0,L=c.length+
B.length;q<L;q++){var h=(q<c.length?c[q]:B[q-c.length]).getBoundingClientRect();h=new E(h.top+p,h.right+C,h.bottom+p,h.left+C);if(b.bottom>h.top&&h.bottom>b.top&&b.left<h.right&&h.left<b.right){b=!1;break a}}b=!0}b?(m=a.H,m.style.top=f[1]-12+"px"):(r=m,m=a.I,m.style.top=f[1]+n+"px");f=A-12;m.style.left=f+"px";f-5>g&&f+24+5<d&&a.A.appendChild(m);a.a.style.top=r+"px";a.a.style.left=l+"px"};
y.prototype.M=function(a){if(a.eventKey===this.u){this.j();this.i.className="display-none";this.c.className="display-none";this.m.className="";this.b.className="display-none";if(a.meaningObj){var b=a.meaningObj;this.f.className="";this.C.innerHTML=b.prettyQuery;this.l.innerHTML=b.meaningText;b.audio&&(this.B.src=b.audio,this.i.className="");this.h.href=b.moreUrl;this.h.innerHTML="More &raquo;";b.attribution&&("translation"===b.type?(this.v.innerHTML=b.attribution,this.s.className="display-none",this.v.className=
""):(this.F.innerHTML=b.attribution,b=this.F.getElementsByTagName("a")[0],this.s.href=b.href,this.s.innerHTML=b.innerHTML.replace("http://",""),this.s.className="",this.v.className="display-none"),this.b.className="")}else this.f.className="display-none",this.l.innerHTML="No definition found.",this.h.href="https://www.google.com/search?q="+encodeURIComponent(a.sanitizedQuery),this.h.innerHTML='Search the web for "'+a.sanitizedQuery+'" \u00bb';a.showOptionsTip&&(this.c.className="");document.documentElement.appendChild(this.g);
F(this)}};var G=function(a,b){b===a.u&&(a.l.innerHTML="Dictionary is disabled for https pages.",a.h.href="https://support.google.com/TODO",a.h.innerHTML="More information \u00bb",a.m.className="",a.f.className="display-none",a.c.className="display-none",a.b.className="display-none",document.documentElement.appendChild(a.g),F(a))},H=function(a,b){b=b.getBoundingClientRect();a.o=new E(b.top,b.right,b.bottom,b.left)};
y.prototype.j=function(){this.u++;var a=this.g;a&&a.parentNode&&a.parentNode.removeChild(a);for(a=this.A;a&&a.hasChildNodes();)a.removeChild(a.childNodes[0])};y.prototype.O=function(a){27===a.keyCode&&this.j()};
var I=function(a,b){return"none"===b||"alt"===b&&a.altKey||"ctrl"===b&&(-1!==window.navigator.platform.toLowerCase().indexOf("mac")?a.metaKey:a.ctrlKey)||"shift"===b&&a.shiftKey},J=function(a,b){for(b=b.target;b;b=b.parentNode)if(b===a.g)return!0;return!1},K=function(a,b,c,d){if("mouseup"===c)var g="true"===d.popupSelect&&I(b,d.popupSelectKey);else"dblclick"===c?g="true"===d.popupSelect&&I(b,d.popupSelectKey)?!1:"true"===d.popupDblclick&&I(b,d.popupDblclickKey):(console.warn("Unexpected eventType: "+
c),g=!1);if(g){g=0;for(var f=z.length;g<f;g++)if(location.href.match(z[g]))return;if(!t(b.target)){g=null;f="";if(window.getSelection){f=window.getSelection();if(1>f.rangeCount)return;g=f.getRangeAt(0);f=k(f.toString())}else document.selection&&(g=document.selection.createRange(),f=k(g.text));if(!(!f||1===f.length&&127>=f.charCodeAt(0)&&!f.match(v)||"dblclick"===c&&-1!==f.indexOf(" "))){a.u++;var n=a.u;J(a,b)||H(a,g);"false"===d.enableHttps&&0===location.href.lastIndexOf("https",0)?G(a,n):(window.setTimeout(function(){n===
this.u&&(this.l.innerHTML="Searching...",this.f.className="display-none",this.c.className="display-none",this.m.className="display-none",this.b.className="display-none",document.documentElement.appendChild(this.g),F(this))}.bind(a),300),chrome.runtime.sendMessage({type:"fetch_raw",eventKey:n,instanceId:a.K,query:f},a.M.bind(a)))}}}};y.prototype.P=function(a){J(this,a)||this.j();var b=function(c){K(this,a,"mouseup",c.options)}.bind(this);chrome.runtime.sendMessage({type:"options"},b)};
y.prototype.L=function(a){var b=function(c){K(this,a,"dblclick",c.options)}.bind(this);chrome.runtime.sendMessage({type:"options"},b)};var D=function(a,b,c){"get_selection"===a.type&&(a=k(window.getSelection().toString()))&&c({selection:a})};y.prototype.N=function(a){"hide"===a.type&&a.instanceId===this.K&&this.j()};var M=M||!1;
if(!M){if(window.gdxBubbleInstance){var N=window.gdxBubbleInstance;chrome.runtime.onMessage.removeListener(D);chrome.runtime.onMessage.removeListener(N.G);N.j()}window.gdxBubbleInstance=new y};})();
