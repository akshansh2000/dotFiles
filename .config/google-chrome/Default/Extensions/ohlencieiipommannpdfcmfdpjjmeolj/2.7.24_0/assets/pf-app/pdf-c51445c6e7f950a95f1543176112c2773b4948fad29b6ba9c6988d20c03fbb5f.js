var analytics=function(){var t=null;return{setCoreWindow:function(e){t=e},sendEvent:function(e,o,n){t.postMessage({type:"PfGaEvent",payload:{category:e,action:o,label:n}},"*")}}}(),Pdf={REPORT_PDF_ERROR:!1,init:function(){this.configure(),this.poll()},configure:function(){this.data={id:PDFSettings.id,start_time:startTime}},poll:function(){Pdf.pollStart||(Pdf.pollStart=new Date),(new Date-Pdf.pollStart)/1e3>PDFSettings.maxWaitTimeInSeconds?Pdf.showError("timeout"):Pdf.makeRequest()},makeRequest:function(){jQuery.ajax({data:Pdf.data,dataType:"json",type:"get",url:"/pdfs/poll.js",timeout:3e3,cache:!1,error:function(t,e,o){"timeout"===e?window.setTimeout(Pdf.poll,1e3):(Pdf.REPORT_PDF_ERROR&&Pdf.reportPdfError(t,e,o),Pdf.showError())},success:function(t){"initialized"===t.state?window.setTimeout(Pdf.poll,300):"complete"===t.state&&(window.parent.postMessage({type:"PfPdfOkEvent"},"*"),Pdf.showDownloadButton(t.url))}})},reportPdfError:function(t,e,o){if(0===window.location.protocol.indexOf("http")){var n="";t.responseJSON&&t.responseJSON.errorType&&(n=t.responseJSON.errorType);var a="s: "+t.status+" | ts: "+e+" | msg: "+o+" | se: "+n;try{Raven.captureException(new Error("pdfError"),{extra:{message:a}})}catch(t){}}},showDownloadButton:function(t){$("a.js-pdf-download").attr("href",t),$(".js-pdf-download").removeClass("disabled"),$("a.js-pdf-download").click(function(){analytics.sendEvent("User Actions","PDF Download")})},showError:function(){$("#pf-dialog-pdf").html("<b>Sorry. An error occurred. Please try again.</b>")}};analytics.setCoreWindow(window.parent),$(document).on("change","#page-size",function(){var t=$(this).val();$("#alternate-page-size input[name=page-size]").val(t),$("#alternate-page-size").submit(),analytics.sendEvent("User Actions","PDF Page Size: "+t)});