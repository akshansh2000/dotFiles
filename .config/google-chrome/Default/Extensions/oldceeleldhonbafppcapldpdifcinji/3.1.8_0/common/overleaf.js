/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Overleaf{static _checkForAvailableInputAreas(){let e=[];OverleafSourceEditor.isEditorPage()?e=OverleafSourceEditor.getInputAreas():OverleafRichTextEditor.isEditorPage()&&(e=OverleafRichTextEditor.getInputAreas());for(const t of e)this._onInputAreaAvailableCallbacks.forEach(e=>e(t))}static init(){this._interval=window.setInterval(()=>{this._checkForAvailableInputAreas()},750)}static onInputAreaAvailable(e){this._onInputAreaAvailableCallbacks.push(t=>e(t,!1))}static isEditorPage(){return OverleafSourceEditor.isEditorPage()||OverleafRichTextEditor.isEditorPage()}static isElementCompatible(e){return OverleafSourceEditor.isEditorPage()?OverleafSourceEditor.isElementCompatible(e):!!OverleafRichTextEditor.isEditorPage()&&OverleafRichTextEditor.isElementCompatible(e)}static isElementIgnored(e){return OverleafSourceEditor.isEditorPage()?OverleafSourceEditor.isElementIgnored(e):!!OverleafRichTextEditor.isEditorPage()&&OverleafRichTextEditor.isElementIgnored(e)}static applyFix(e){return OverleafSourceEditor.isEditorPage()?OverleafSourceEditor.applyFix(e):OverleafRichTextEditor.isEditorPage()?OverleafRichTextEditor.applyFix(e):Promise.reject()}static destroy(){null!==this._interval&&(window.clearInterval(this._interval),this._interval=null),this._onInputAreaAvailableCallbacks=[]}}Overleaf._interval=null,Overleaf._onInputAreaAvailableCallbacks=[];class OverleafSourceEditor{static _constructor(){this._domMeasurement=new DomMeasurement}static isEditorPage(){return null!==document.querySelector(this.EDITOR_SELECTOR)}static getInputAreas(){return Array.from(document.querySelectorAll(this.EDITOR_SELECTOR))}static isElementCompatible(e){return e.matches(this.EDITOR_SELECTOR)}static isElementIgnored(e){return!contains(e,this.INPUT_AREA_SELECTOR)&&!closestElement(e,this.INPUT_AREA_SELECTOR)}static applyFix(e){const{editor:t,offset:r,replacementText:i}=e,a=t.inputArea.querySelector(this.PASTE_TEXTAREA_SELECTOR);if(!a)return Promise.resolve();const o=t.inputAreaWrapper.getTextRanges(r.start,r.length),s=o[0].textNode.parentElement,n=o[o.length-1].textNode.parentElement;this._domMeasurement.clearCache();const l=this._domMeasurement.getTextBoundingBoxes(o,t.inputArea,!1),E=l[0],c=l[l.length-1],u={clientX:E.left,clientY:E.top+E.height/2,bubbles:!0,shftKey:!1},d={clientX:c.right,clientY:c.top+c.height/2,bubbles:!0,shftKey:!1};return Promise.resolve().then(()=>(s.dispatchEvent(new MouseEvent("mousedown",u)),n.dispatchEvent(new MouseEvent("mousemove",d)),n.dispatchEvent(new MouseEvent("mouseup",d)),wait(10))).then(()=>{const e=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});e.clipboardData.setData("text/plain",i),a.dispatchEvent(e)})}}OverleafSourceEditor.EDITOR_SELECTOR="div#editor",OverleafSourceEditor.INPUT_AREA_SELECTOR="div.ace_layer.ace_text-layer",OverleafSourceEditor.PASTE_TEXTAREA_SELECTOR="textarea.ace_text-input";class OverleafRichTextEditor{static _constructor(){this._domMeasurement=new DomMeasurement}static isEditorPage(){return null!==document.querySelector(this.EDITOR_SELECTOR)}static getInputAreas(){return Array.from(document.querySelectorAll(this.INPUT_AREA_SELECTOR))}static isElementCompatible(e){return e.matches(this.INPUT_AREA_SELECTOR)}static isElementIgnored(e){return e.classList.contains("CodeMirror-linenumber")}static applyFix(e){const{editor:t,offset:r,replacementText:i}=e,a=closestElement(t.inputArea,this.EDITOR_SELECTOR);if(!a)return Promise.resolve();const o=a.querySelector(this.PASTE_TEXTAREA_SELECTOR);if(!o)return Promise.resolve();const s=t.inputAreaWrapper.getTextRanges(r.start,r.length),n=s[0].textNode.parentElement,l=s[s.length-1].textNode.parentElement;this._domMeasurement.clearCache();const E=this._domMeasurement.getTextBoundingBoxes(s,t.inputArea,!1),c=E[0],u=E[E.length-1],d={clientX:c.left,clientY:c.top+c.height/2,bubbles:!0,shftKey:!1},h={clientX:u.right,clientY:u.top+u.height/2,bubbles:!0,shftKey:!1};return Promise.resolve().then(()=>(n.dispatchEvent(new MouseEvent("mousedown",d)),l.dispatchEvent(new MouseEvent("mousemove",h)),l.dispatchEvent(new MouseEvent("mouseup",h)),wait(10))).then(()=>{const e=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});e.clipboardData.setData("text/plain",i),o.dispatchEvent(e)})}}OverleafRichTextEditor.EDITOR_SELECTOR="div#editor-rich-text",OverleafRichTextEditor.INPUT_AREA_SELECTOR="div.CodeMirror-code",OverleafRichTextEditor.PASTE_TEXTAREA_SELECTOR="div > textarea[tabindex='0']",OverleafSourceEditor._constructor(),OverleafRichTextEditor._constructor();