/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
{Tracker.trackPageView();const e=StorageController.create(),n=new URL(location.href),t=document.getElementById("feedback-form"),a=document.getElementById("headline"),o=document.getElementById("feedback-form-direct-email"),r=document.getElementById("sender"),s=document.getElementById("text"),g=document.getElementById("success-message"),c=document.getElementById("screenshot-label"),i=document.getElementById("screenshot");translateSection(document.documentElement),n.searchParams.get("title")&&(a.textContent=n.searchParams.get("title")),"1"===n.searchParams.get("screenshot")&&(c.style.display="block",i.checked=!0,o.style.display="none");const l=n.searchParams.get("html"),d=n.searchParams.get("url")||"",m=getDomain(d),u=EnvironmentAdapter.getVersion(),$=`Feedback LanguageTool on ${m} (v${u}, lang: ${navigator.language}, browser: ${BrowserDetector.getBrowserName()})`,y=`<a href="mailto:feedback@languagetool.org?subject=${encodeURIComponent($)}">feedback@languagetool.org</a>`;o.innerHTML=i18nManager.getMessage("feedbackDirectMail",[y]),t.addEventListener("submit",n=>{n.preventDefault();const a=r.value;Tracker.trackEvent("Action","send_feedback",a),e.onReady(()=>{const{firstVisit:n,ratingValue:o,sessionCount:c}=e.getStatistics(),{hasPaidSubscription:m,lastChangelogSeen:$}=e.getUIState(),{geoIpLanguages:y,apiServerUrl:k,knownEmail:h,username:v,geoIpCountry:E,ignoredRules:b,hasSynonymsEnabled:f}=e.getSettings(),I=b.filter(e=>!StorageControllerClass.getDefaultSettings().ignoredRules.find(n=>n.id===e.id));let S=`From: ${r.value}\n`;S+=`Paying: ${m}\n`,S+=`Account: ${v||"none"}\n`,S+=`Other known email: ${h||v}\n`,S+=`Addon Version: ${u}\n`,S+=`Accept-Languages: ${navigator.languages.join(", ")}\n`,S+=`UI-Language: ${browser.i18n.getUILanguage()}\n`,S+=`GeoIP-Languages: ${y.join(", ")}\n`,S+=`Country: ${E}\n`,S+=`Full URL: ${d}\n`,S+=`HTML: ${l||""}\n`,S+=`Matomo: ${e.getUniqueId()}\n`,S+=`User Agent: ${navigator.userAgent}\n`,S+=`CPU Cores: ${navigator.hardwareConcurrency}\n`,S+=`User since: ${new Date(1e3*(n||0)).toUTCString()}\n`,S+=`Rating: ${o}\n`,S+=`Synonyms: ${f}\n`,S+=`Sessions: ${c}\n`,S+=`API: ${k}\n`,S+=`DNT: ${navigator.doNotTrack}\n`,S+=`Downlink: ${navigator.connection&&navigator.connection.downlink}\n`,S+=`Connection Type: ${navigator.connection&&navigator.connection.effectiveType}\n`,S+=`Ignored Rules: ${I.map(e=>e.id).join(",")}\n`,S+=`Last Changelog: ${$}\n`;const p=`${s.value}\n\n\n${S}`;e.updateSettings({knownEmail:a});const C={command:"SEND_FEEDBACK",sender:r.value,text:p,includeScreenshot:i.checked};browser.runtime.sendMessage(C).then(()=>{t.style.display="none",g.style.display="block"}).catch(()=>{Tracker.trackError("message","error_send_feedback"),alert(i18nManager.getMessage("feedbackError"))})})})}