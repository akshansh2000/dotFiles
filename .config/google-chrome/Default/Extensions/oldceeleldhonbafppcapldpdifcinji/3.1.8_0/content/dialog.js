/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,r)}l((o=o.apply(e,t||[])).next())})};class Dialog{constructor(e,t,n,o){this._toolbarContainer=e,this._uiOptions=o,this._document=this._toolbarContainer.ownerDocument,this._languageCode=t,this._onUnload=bindAndCatch(this._onUnload,this),window.addEventListener("pagehide",this._onUnload,!0),this._controls={},this._eventListeners=[],this._render().then(()=>{this.setCurrentLanguage(t||LanguageManager.getUserLanguageCode()),this.updateState(n)}),this._eventListeners.push(addUseCaptureEvent(document,"keydown",this._onKeydown.bind(this))),this._inApplyFixMode=!1}_render(){return __awaiter(this,void 0,void 0,function*(){if(this._controls.container)return;this._controls.container=this._document.createElement(Dialog.CONTAINER_ELEMENT_NAME),this._controls.container.setAttribute("contenteditable","false");const e=e=>{e.stopImmediatePropagation()};if(this._eventListeners.push(addUseCaptureEvent(this._controls.container,"mousedown",t=>{if(t.target===this._controls.languageSelector){const e=e=>{e.stopImmediatePropagation()};document.addEventListener("blur",e,!0),setTimeout(()=>{document.removeEventListener("blur",e,!0)},10)}e(t)}),addUseCaptureEvent(this._controls.container,"mouseup",e),addUseCaptureEvent(this._controls.container,"pointerdown",e),addUseCaptureEvent(this._controls.container,"pointerup",e),addUseCaptureEvent(this._controls.container,"focusin",e),addUseCaptureEvent(this._controls.container,"focusout",e)),this._controls.container.addEventListener("click",e),this._controls.innerContainer=this._document.createElement("lt-div"),this._controls.innerContainer.className="lt-dialog__container notranslate",this._controls.container.appendChild(this._controls.innerContainer),this._controls.header=this._document.createElement("lt-div"),this._controls.header.className="lt-dialog__header",this._controls.innerContainer.appendChild(this._controls.header),this._controls.languageSelectorWrapper=this._document.createElement("lt-div"),this._controls.languageSelectorWrapper.className="lt-dialog__language-selector-wrapper",this._controls.header.appendChild(this._controls.languageSelectorWrapper),this._controls.currentLanguage=this._document.createElement("lt-span"),this._controls.currentLanguage.className="lt-dialog__current-language",this._controls.languageSelectorWrapper.appendChild(this._controls.currentLanguage),this._controls.languageSelector=this._document.createElement("select"),this._controls.languageSelector.className="lt-dialog__language-selector",this._eventListeners.push(addUseCaptureEvent(this._controls.languageSelector,"change",this._onLanguageChange.bind(this))),Dialog.MESSAGES.LANGUAGES.forEach(e=>{const t=this._document.createElement("option");t.value=e.code,t.textContent=e.name,this._controls.languageSelector.appendChild(t)}),EnvironmentAdapter.isRuntimeConnected()){const e=yield EnvironmentAdapter.getPreferredLanguages();if(!this._controls.languageSelector||!e.length)return;const t=this._controls.languageSelector.value,n=this._document.createElement("optgroup");n.label=Dialog.MESSAGES.ALL_LANGUAGES,Array.from(this._controls.languageSelector.children).forEach(e=>{n.append(e)});const o=this._document.createElement("optgroup");o.label=Dialog.MESSAGES.RECOMMENDED_LANGUAGES,e.forEach(e=>{const t=LanguageManager.LANGUAGES.find(t=>t.code.startsWith(e.toLowerCase()));if(t){const e=this._document.createElement("option");e.value=t.code,e.textContent=t.name,o.appendChild(e)}}),this._controls.languageSelector.append(o),this._controls.languageSelector.append(n),this._controls.languageSelector.value=t}this._controls.languageSelectorWrapper.appendChild(this._controls.languageSelector),this._controls.optionsLink=this._document.createElement("lt-span"),this._controls.optionsLink.className="lt-dialog__options-link",this._controls.optionsLink.title=Dialog.MESSAGES.OPTIONS_TITLE,this._eventListeners.push(addUseCaptureEvent(this._controls.optionsLink,"click",this._onOptionsClick.bind(this))),this._uiOptions.disableOptionsPage||this._controls.header.appendChild(this._controls.optionsLink),this._controls.content=this._document.createElement("lt-div"),this._controls.content.className="lt-dialog__content",this._controls.innerContainer.appendChild(this._controls.content),this._controls.footer=this._document.createElement("lt-div"),this._controls.footer.className="lt-dialog__footer",this._controls.innerContainer.appendChild(this._controls.footer),this._controls.incompleteResult=this._document.createElement("lt-div"),this._controls.incompleteResult.className="lt-dialog__incomplete-result",this._controls.incompleteResult.textContent=Dialog.MESSAGES.INCOMPLETE_RESULT,this._controls.footer.appendChild(this._controls.incompleteResult),this._controls.poweredBy=this._document.createElement("lt-span"),this._controls.poweredBy.className="lt-dialog__powered-by",this._controls.poweredBy.innerHTML=Dialog.MESSAGES.POWERED_BY,this._eventListeners.push(addUseCaptureEvent(this._controls.poweredBy,"click",this._gotoLanguageTool.bind(this))),this._controls.footer.appendChild(this._controls.poweredBy),this._controls.sendFeedback=this._document.createElement("lt-span"),this._controls.sendFeedback.className="lt-dialog__send-feedback",this._controls.sendFeedback.innerHTML=Dialog.MESSAGES.FEEDBACK,this._eventListeners.push(addUseCaptureEvent(this._controls.sendFeedback,"click",this._showFeedbackForm.bind(this))),this._uiOptions.disableFeedbackForm||this._controls.footer.appendChild(this._controls.sendFeedback),this._controls.pointer=this._document.createElement("lt-span"),this._controls.pointer.className="lt-dialog__pointer",this._controls.innerContainer.appendChild(this._controls.pointer),this._toolbarContainer.appendChild(this._controls.container),this._toolbarContainer.classList.add("lt-toolbar--dialog-opened")})}_position(){const e=new DomMeasurement(this._document);let t=this._controls.innerContainer.getBoundingClientRect();t.right>=this._document.documentElement.clientWidth-Dialog.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),(t=this._controls.innerContainer.getBoundingClientRect()).bottom>=this._document.documentElement.clientHeight&&this._alignToTop();const n=e.getDocumentScroll();t=this._controls.innerContainer.getBoundingClientRect(),n.top+t.top<=Dialog.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),t.top<0&&!isScrollable(document.body)&&!isScrollable(document.documentElement)&&this._alignToBottom()}_alignToBottom(){const e=new DomMeasurement(this._document);this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.add("lt-dialog__container-bottom");const t=this._controls.innerContainer.getBoundingClientRect();if(t.left<=Dialog.SPACE_TO_SCREEN_EDGE){const n=parseInt(e.getStyle(this._controls.innerContainer,"right"),10)+t.left-Dialog.SPACE_TO_SCREEN_EDGE,o=parseInt(e.getStyle(this._controls.pointer,"right"),10)-t.left+Dialog.SPACE_TO_SCREEN_EDGE;e.setStyles(this._controls.innerContainer,{right:n+"px !important",left:"auto !important"}),e.setStyles(this._controls.pointer,{right:o+"px !important",left:"auto !important"})}if(t.right>this._document.documentElement.clientWidth){e.setStyles(this._controls.innerContainer,{right:"0px !important",left:"auto !important"});const n=parseInt(e.getStyle(this._controls.pointer,"right"),10)+(this._controls.innerContainer.getBoundingClientRect().right-t.right);e.setStyles(this._controls.pointer,{right:n+"px !important",left:"auto !important"})}}_alignToTop(){this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container-top");const e=this._controls.innerContainer.getBoundingClientRect(),t=new DomMeasurement(this._document);if(this._controls.innerContainer.classList.add("lt-dialog__container-hide"),e.right>=this._document.documentElement.clientWidth-Dialog.SPACE_TO_SCREEN_EDGE){const n=parseInt(t.getStyle(this._controls.innerContainer,"left"),10)-(e.right-this._document.documentElement.clientWidth)-Dialog.SPACE_TO_SCREEN_EDGE,o=parseInt(t.getStyle(this._controls.pointer,"left"),10)+(e.right-this._document.documentElement.clientWidth)+Dialog.SPACE_TO_SCREEN_EDGE;t.setStyles(this._controls.innerContainer,{left:n+"px !important",right:"auto !important"}),t.setStyles(this._controls.pointer,{left:o+"px !important",right:"auto !important"})}this._controls.innerContainer.classList.remove("lt-dialog__container-hide")}_removeTeaser(){this._controls.teaserElement&&(this._controls.teaserElement.remove(),this._controls.teaserElement=void 0)}_updateContent(){if(!this._controls.content)return;this._controls.content.innerHTML="",this._controls.content.classList.remove("lt-dialog__has-errors");const e=this._state.validationStatus;e===VALIDATION_STATUS.COMPLETED||this._inApplyFixMode&&e===VALIDATION_STATUS.IN_PROGRESS?this._renderCompletedState():e===VALIDATION_STATUS.IN_PROGRESS?this._renderInProgressState():e===VALIDATION_STATUS.DISABLED?this._renderDisabledState():e===VALIDATION_STATUS.TEXT_TOO_SHORT?this._renderTextTooShortState():e===VALIDATION_STATUS.TEXT_TOO_LONG?this._renderTextTooLongState():e===VALIDATION_STATUS.UNSUPPORTED_LANGUAGE?this._renderLanguageUnsupportedState():e===VALIDATION_STATUS.DISCONNECTED?this._renderDisconnectedState():e===VALIDATION_STATUS.FAILED&&this._renderFailedState(),this._position()}_renderInProgressState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__big-loader",this._controls.content.appendChild(e)}_renderCompletedState(){this._state.errors&&this._state.errors.length?(this._renderErrors(),this._renderIgnoredErrorsStats(),this._renderPremiumErrorsTeaser()):this._state.premiumErrors&&this._state.premiumErrors.length?(this._removeTeaser(),this._renderPremiumState()):(this._renderNoErrorsState(),this._renderIgnoredErrorsStats(),this._renderPremiumErrorsTeaser()),this._controls.incompleteResult.classList.toggle("lt-dialog__incomplete-result-show",!!this._state.isIncompleteResult)}_renderErrors(){this._controls.content.classList.add("lt-dialog__has-errors"),this._state.errors.forEach(e=>{const t=this._document.createElement("lt-div");t.className="lt-dialog__error-item";const n=this._document.createElement("lt-div");n.className="lt-dialog__error-headline",e.isSpellingError?(n.textContent=Dialog.MESSAGES.HEADLINE_SPELLING_ERROR,n.style.color=config.COLORS.SPELLING.TITLE):e.isStyleError?(n.textContent=Dialog.MESSAGES.HEADLINE_SUGGESTION_ERROR,n.style.color=config.COLORS.STYLE.TITLE):e.isPunctuationError?(n.textContent=Dialog.MESSAGES.HEADLINE_PUNCTUATION_ERROR,n.style.color=config.COLORS.GRAMMAR.TITLE):(n.textContent=Dialog.MESSAGES.HEADLINE_GRAMMAR_ERROR,n.style.color=config.COLORS.GRAMMAR.TITLE);const o=this._document.createElement("lt-span");o.className="lt-dialog__error-scroll-to-link",o.textContent=Dialog.MESSAGES.SCROLL_TO_LINK,this._eventListeners.push(addUseCaptureEvent(o,"click",t=>{this._onErrorSelected(e.id)})),n.appendChild(o),t.append(n);const i=this._document.createElement("lt-div");if(i.className="lt-dialog__error-text",i.textContent=e.description,t.append(i),e.rule.urls&&e.rule.urls.length>0){const t=this._document.createElement("lt-span");t.classList.add("lt-dialog__more-details"),t.title=i18nManager.getMessage("moreDetails"),this._eventListeners.push(addUseCaptureEvent(t,"click",t=>{this._onMoreDetailsClick(e.rule.urls[0],t)})),i.appendChild(t)}t.addEventListener("mouseenter",()=>this._onErrorHighlighted(e.id)),t.addEventListener("mouseleave",()=>this._onErrorHighlighted(null));const s=Math.min(e.fixes.length,config.MAX_FIXES_COUNT);for(let n=0;n<s;n++){const o=this._document.createElement("lt-div");o.className="lt-dialog__fix-container";const i=this._document.createElement("lt-div");i.className="lt-dialog__original-phrase",i.textContent=e.originalPhrase,o.appendChild(i);const s=this._document.createElement("lt-div");s.className="lt-dialog__arrow",o.appendChild(s);const a=this._document.createElement("lt-div");a.textContent=e.fixes[n].value.replace(Dialog.TRAILING_WHITESPACE_REGEXP,"·"),a.title=e.fixes[n].shortDescription||"",a.className="lt-dialog__fix",this._eventListeners.push(addUseCaptureEvent(a,"click",o=>{this._onFixClick(e,n,o),t.remove()})),o.appendChild(a),t.appendChild(o),e.fixes[n].value.length>=14&&t.classList.add("lt-dialog__long-fix")}if(0===s){const n=this._document.createElement("lt-div");n.className="lt-dialog__fix-container";const o=this._document.createElement("lt-div");o.className="lt-dialog__original-phrase",o.textContent=e.originalPhrase,n.appendChild(o),t.appendChild(n)}if(e.isSpellingError){if(!this._uiOptions.disableAddingWord&&!includesWhiteSpace(e.originalPhrase)){const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__add-to-dictionary"),n.textContent=i18nManager.getMessage("addToDictionaryTitle",e.originalPhrase),this._eventListeners.push(addUseCaptureEvent(n,"click",n=>{this._onAddToDictionaryClick(e,n),t.remove()})),t.appendChild(n)}const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__temporarily-ignore-word"),n.textContent=i18nManager.getMessage("ignoreHere"),this._eventListeners.push(addUseCaptureEvent(n,"click",n=>{this._onTemporarilyIgnoreWordClick(e,n),t.remove()})),t.appendChild(n)}else{if(!this._uiOptions.disableIgnoringRule){const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__ignore-rule"),n.textContent=i18nManager.getMessage("turnOffRule"),this._eventListeners.push(addUseCaptureEvent(n,"click",n=>{this._onIgnoreRuleClick(e,n),t.remove()})),t.appendChild(n)}const n=this._document.createElement("lt-div");n.classList.add("lt-dialog__temporarily-ignore-rule"),n.textContent=i18nManager.getMessage("ignoreHere"),this._eventListeners.push(addUseCaptureEvent(n,"click",n=>{this._onTemporarilyIgnoreRuleClick(e,n),t.remove()})),t.appendChild(n)}this._controls.content.appendChild(t)})}_renderTextTooShortState(){this._removeTeaser();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-too-short__headline",e.innerHTML=Dialog.MESSAGES.TEXT_TOO_SHORT_HEADLINE;const t=this._document.createElement("lt-div");t.className="lt-dialog__text-too-short__text",t.innerHTML=Dialog.MESSAGES.TEXT_TOO_SHORT_TEXT,this._controls.content.appendChild(e),this._controls.content.appendChild(t)}_renderNoErrorsState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__no-errors",e.innerHTML=Dialog.MESSAGES.NO_ERRORS,this._controls.content.appendChild(e),this._renderRatingTeaser()}_renderIgnoredErrorsStats(){if(!this._state.ignoredErrorsStats)return;if(0===this._state.ignoredErrorsStats.byDictionary&&0===this._state.ignoredErrorsStats.byRules)return;const e=this._document.createElement("lt-div");if(this._state.errors&&this._state.errors.length?e.className="lt-dialog__ignored-errors-item":e.className="lt-dialog__ignored-errors-message",this._state.ignoredErrorsStats.byDictionary>0&&!this._uiOptions.disableAddingWord){const t=1===this._state.ignoredErrorsStats.byDictionary?"errorsIgnoredByDictionarySingular":"errorsIgnoredByDictionary",n=i18nManager.getMessage(t,[this._state.ignoredErrorsStats.byDictionary]),o=document.createElement("lt-span");o.textContent=n,o.dataset.type="byDictionary",e.appendChild(o)}if(this._state.ignoredErrorsStats.byRules>0&&!this._uiOptions.disableIgnoringRule){if(this._state.ignoredErrorsStats.byDictionary>0){const t=document.createElement("lt-span");t.textContent=", ",e.appendChild(t)}const t=1===this._state.ignoredErrorsStats.byRules?"errorsIgnoredByRulesSingular":"errorsIgnoredByRules",n=i18nManager.getMessage(t,[this._state.ignoredErrorsStats.byRules]),o=document.createElement("lt-span");o.textContent=n,o.dataset.type="byRules",e.appendChild(o)}this._controls.content.appendChild(e),this._eventListeners.push(addUseCaptureEvent(e,"click",this._onIgnoredErrorsClick.bind(this)))}_renderRatingTeaser(){if(!this._state.premiumErrors.length&&!this._controls.teaserElement&&!this._uiOptions.disableRatingTeaser&&EnvironmentAdapter.isRuntimeConnected()&&0===Math.floor(2*Math.random())){let e=EnvironmentAdapter.getURL("/content/iframes/rating/rating.html");e+=`?componentName=dialog&url=${encodeURIComponent(getCurrentUrl().substr(0,150))}`,this._controls.teaserElement=this._document.createElement("iframe"),this._controls.teaserElement.src=e,this._controls.teaserElement.className="lt-dialog-iframe lt-dialog-rating-iframe",this._controls.content.after(this._controls.teaserElement)}}_renderPremiumErrorsTeaser(){if(this._state.premiumErrors.length&&!this._controls.teaserElement&&EnvironmentAdapter.isRuntimeConnected()){let e=EnvironmentAdapter.getURL("/content/iframes/premiumErrors/premiumErrors.html");const t=this._state.premiumErrors.filter(e=>!e.isStyleError).length,n=this._state.premiumErrors.filter(e=>e.isStyleError).length;e+=`?grammarMatches=${t}`,e+=`&styleMatches=${n}`,this._controls.teaserElement=this._document.createElement("iframe"),this._controls.teaserElement.src=e,this._controls.teaserElement.className="lt-dialog-iframe lt-dialog-premium-errors-iframe",this._controls.content.after(this._controls.teaserElement)}}_renderPremiumState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__premium__headline",e.textContent=1===this._state.premiumErrors.length?i18nManager.getMessage("dialogPremiumHeadlineSingular"):i18nManager.getMessage("dialogPremiumHeadlinePlural",[this._state.premiumErrors.length]);const t=this._document.createElement("lt-div");t.className="lt-dialog__premium__text",t.textContent=i18nManager.getMessage("dialogPremiumText");const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__button",n.textContent=i18nManager.getMessage("dialogPremiumButton"),this._eventListeners.push(addUseCaptureEvent(n,"click",e=>{e.stopImmediatePropagation();let t="https://languagetoolplus.com/webextension/upgrade?pk_campaign=addon2-dialog-premium";t+=`&grammarMatches=${this._state.premiumErrors.filter(e=>!e.isStyleError).length}`,t+=`&styleMatches=${this._state.premiumErrors.filter(e=>e.isStyleError).length}`,this._languageCode&&(t+=`&textLang=${this._languageCode}`),window.open(t,"_blank"),Tracker.trackEvent("Action","dialog:premium:click")})),this._controls.content.appendChild(e),this._controls.content.appendChild(t),this._controls.content.appendChild(n)}_renderDisabledState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__enable-text",e.innerHTML=Dialog.MESSAGES.ENABLE;const t=this._document.createElement("lt-div");t.className="lt-dialog__enable-everywhere",t.innerHTML=Dialog.MESSAGES.ENABLE_EVERYWHERE_BUTTON,this._eventListeners.push(addUseCaptureEvent(t,"click",this._enableEverywhere.bind(this)));const n=this._document.createElement("lt-div");n.className="lt-dialog__enable-here",n.innerHTML=Dialog.MESSAGES.ENABLE_HERE_BUTTON,this._eventListeners.push(addUseCaptureEvent(n,"click",this._enableHere.bind(this))),this._controls.content.appendChild(e),this._controls.content.appendChild(t),this._controls.content.appendChild(n)}_renderTextTooLongState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__premium__headline",e.textContent=Dialog.MESSAGES.TEXT_TOO_LONG_HEADLINE;const t=this._document.createElement("lt-div");t.className="lt-dialog__premium__text",t.textContent=Dialog.MESSAGES.TEXT_TOO_LONG_TEXT;const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__button",n.textContent=Dialog.MESSAGES.TEXT_TOO_LONG_BUTTON,this._eventListeners.push(addUseCaptureEvent(n,"click",e=>{e.stopImmediatePropagation(),window.open("https://languagetoolplus.com/webextension/upgrade?pk_campaign=addon2-dialog-text-too-long","_blank"),Tracker.trackEvent("Action","dialog:text_too_long:click")})),this._controls.content.appendChild(e),this._controls.content.appendChild(t),this._controls.content.appendChild(n)}_renderLanguageUnsupportedState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__language-unsupported__headline",e.textContent=Dialog.MESSAGES.UNSUPPORTED_LANGUAGE_HEADLINE;const t=this._document.createElement("lt-div");if(t.className="lt-dialog__language-unsupported__text",t.textContent=Dialog.MESSAGES.UNSUPPORTED_LANGUAGE_TEXT,this._controls.content.appendChild(e),this._controls.content.appendChild(t),this._controls.currentLanguage){this._controls.currentLanguage.textContent=Dialog.MESSAGES.SELECT_LANGUAGE_LABEL;const e=this._document.createElement("option");e.disabled=!0,e.selected=!0,e.textContent=Dialog.MESSAGES.UNSUPPORTED_LANGUAGE_LABEL,this._controls.languageSelector.prepend(e),new DomMeasurement(this._document).setStyles(this._controls.currentLanguage,{"background-image":""})}}_renderDisconnectedState(){this._controls.header.remove(),this._controls.sendFeedback.remove();const e=this._document.createElement("lt-div");e.innerHTML=Dialog.MESSAGES.EXTENSION_UPDATED_HEADLINE,e.className="lt-dialog__exception-headline",this._controls.content.appendChild(e);const t=this._document.createElement("lt-div");t.innerHTML=Dialog.MESSAGES.EXTENSION_UPDATED_TEXT,t.className="lt-dialog__exception-message",this._controls.content.appendChild(t)}_renderFailedState(){const e=this._document.createElement("lt-div");e.innerHTML=DOMPurify.sanitize(this._state.validationErrorMessage)||i18nManager.getMessage("statusIconError"),e.className="lt-dialog__exception-message",this._controls.content.appendChild(e)}_onUnload(){this.destroy()}_onKeydown(e){"Escape"===e.key&&(this.destroy(),e.stopImmediatePropagation())}_onLanguageChange(e){e.stopImmediatePropagation();const t={dialog:this,language:this._controls.languageSelector.value};dispatchCustomEvent(document,Dialog.eventNames.languageChanged,t),this.setCurrentLanguage(this._controls.languageSelector.value)}_onTurnOffClick(){const e={dialog:this};dispatchCustomEvent(document,Dialog.eventNames.turnOff,e)}_onOptionsClick(e){e.stopImmediatePropagation();const t={dialog:this};dispatchCustomEvent(document,Dialog.eventNames.openOptions,t)}_onIgnoredErrorsClick(e){e.stopImmediatePropagation();let t="personalDictionary";if(e.target){const n=e.target;n.dataset&&"byRules"===n.dataset.type&&(t="ignoredRules")}const n={dialog:this,target:t,ref:"dialog-ignored-errors"};dispatchCustomEvent(document,Dialog.eventNames.openOptions,n)}_gotoLanguageTool(e){e.stopImmediatePropagation(),window.open("https://languagetoolplus.com/?pk_campaign=addon2-dialog","_blank")}_showFeedbackForm(e){e.stopImmediatePropagation();const t={dialog:this};dispatchCustomEvent(document,Dialog.eventNames.showFeedbackForm,t)}_onErrorHighlighted(e){const t={dialog:this,errorId:e};dispatchCustomEvent(document,Dialog.eventNames.errorHighlighted,t)}_onErrorSelected(e){const t={dialog:this,errorId:e};dispatchCustomEvent(document,Dialog.eventNames.errorSelected,t)}_onMoreDetailsClick(e,t){t.stopImmediatePropagation();const n={dialog:this,url:e.value};dispatchCustomEvent(document,Dialog.eventNames.moreDetailsClicked,n)}_onFixClick(e,t,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const o={dialog:this,error:e,fixIndex:t};dispatchCustomEvent(document,Dialog.eventNames.fixSelected,o)}_onAddToDictionaryClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e};dispatchCustomEvent(document,Dialog.eventNames.addToDictionaryClicked,n)}_onIgnoreRuleClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e};dispatchCustomEvent(document,Dialog.eventNames.ignoreRuleClicked,n)}_onTemporarilyIgnoreWordClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e};dispatchCustomEvent(document,Dialog.eventNames.temporarilyIgnoreWordClicked,n)}_onTemporarilyIgnoreRuleClick(e,t){t.stopImmediatePropagation(),this._inApplyFixMode=!0;const n={dialog:this,error:e};dispatchCustomEvent(document,Dialog.eventNames.temporarilyIgnoreRuleClicked,n)}_enableEverywhere(e){e.stopImmediatePropagation();const t={dialog:this};dispatchCustomEvent(document,Dialog.eventNames.enableEverywhere,t)}_enableHere(e){e.stopImmediatePropagation();const t={dialog:this};dispatchCustomEvent(document,Dialog.eventNames.enableHere,t)}updateState(e){isSameObjects(this._state,e)||(this._state=Object.assign(this._state||{},e),this._updateContent())}setCurrentLanguage(e){if(!EnvironmentAdapter.isRuntimeConnected())return;e=e.toLowerCase();const t=LanguageManager.LANGUAGES.find(t=>t.code===e)||LanguageManager.LANGUAGES.find(t=>e.startsWith(t.code))||LanguageManager.LANGUAGES.find(e=>"en-us"===e.code),n=EnvironmentAdapter.getURL("/assets/images/flags/"+t.code+".svg");this._controls.currentLanguage.textContent=t.name,new DomMeasurement(this._document).setStyles(this._controls.currentLanguage,{"background-image":`url('${n}') !important`}),this._controls.languageSelector.value=t.code}destroy(){fadeOutAndRemove(this._controls.container,()=>{this._toolbarContainer.classList.remove("lt-toolbar--dialog-opened")}),this._controls={},window.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach(e=>{e.destroy()}),this._eventListeners=[];const e={dialog:this};dispatchCustomEvent(document,Dialog.eventNames.destroyed,e)}}Dialog.CONTAINER_ELEMENT_NAME="lt-dialog",Dialog.SPACE_TO_SCREEN_EDGE=5,Dialog.TRAILING_WHITESPACE_REGEXP=/^ | $/,Dialog.MESSAGES={EXTENSION_UPDATED_HEADLINE:i18nManager.getMessage("extensionUpdatedHeadline"),EXTENSION_UPDATED_TEXT:i18nManager.getMessage("extensionUpdatedText",["<lt-span class='lt-dialog__icon'></lt-span>"]),INCOMPLETE_RESULT:i18nManager.getMessage("incompleteResult"),POWERED_BY:i18nManager.getMessage("poweredBy"),FEEDBACK:i18nManager.getMessage("reportAnIssue"),ENABLE:i18nManager.getMessage("enableInDialog"),ENABLE_EVERYWHERE_BUTTON:i18nManager.getMessage("enableEverywhereButton"),ENABLE_HERE_BUTTON:i18nManager.getMessage("enableHereButton"),OPTIONS_TITLE:i18nManager.getMessage("settingsHeadline"),NO_ERRORS:i18nManager.getMessage("noErrorsFound2"),TEXT_TOO_LONG_HEADLINE:i18nManager.getMessage("dialogTextTooLongHeadline"),TEXT_TOO_LONG_TEXT:i18nManager.getMessage("dialogTextTooLongText"),TEXT_TOO_LONG_BUTTON:i18nManager.getMessage("dialogTextTooLongButton"),TEXT_TOO_SHORT_TEXT:i18nManager.getMessage("dialogTextTooShortText"),TEXT_TOO_SHORT_HEADLINE:i18nManager.getMessage("dialogTextTooShortHeadline"),HEADLINE_SPELLING_ERROR:i18nManager.getMessage("spellingError"),HEADLINE_SUGGESTION_ERROR:i18nManager.getMessage("suggestionError"),HEADLINE_PUNCTUATION_ERROR:i18nManager.getMessage("punctuationError"),HEADLINE_GRAMMAR_ERROR:i18nManager.getMessage("grammarError"),SELECT_LANGUAGE_LABEL:i18nManager.getMessage("dialogSelectLanguageLabel"),UNSUPPORTED_LANGUAGE_LABEL:i18nManager.getMessage("dialogUnsupportedLanguageLabel"),UNSUPPORTED_LANGUAGE_HEADLINE:i18nManager.getMessage("dialogUnsupportedLanguageHeadline"),UNSUPPORTED_LANGUAGE_TEXT:i18nManager.getMessage("dialogUnsupportedLanguageText"),ALL_LANGUAGES:i18nManager.getMessage("dialogAllLanguages"),RECOMMENDED_LANGUAGES:i18nManager.getMessage("dialogRecommendedLanguages"),SCROLL_TO_LINK:i18nManager.getMessage("dialogScrollToLink"),LANGUAGES:LanguageManager.LANGUAGES},Dialog.eventNames={turnOff:"lt-dialog.turnOff",enableHere:"lt-dialog.enableHere",enableEverywhere:"lt-dialog.enableEverywhere",languageChanged:"lt-dialog.languageChanged",errorSelected:"lt-dialog.errorSelected",errorHighlighted:"lt-dialog.errorHighlighted",addToDictionaryClicked:"lt-dialog.addToDictionaryClicked",ignoreRuleClicked:"lt-dialog.ignoreRuleClicked",temporarilyIgnoreWordClicked:"lt-dialog.temporarilyIgnoreWordClicked",temporarilyIgnoreRuleClicked:"lt-dialog.temporarilyIgnoreRuleClicked",moreDetailsClicked:"lt-dialog.moreDetailsClicked",fixSelected:"lt-dialog.fixSelected",openOptions:"lt-dialog.openOptions",showFeedbackForm:"lt-dialog.showFeedbackForm",destroyed:"lt-dialog.destroyed"};