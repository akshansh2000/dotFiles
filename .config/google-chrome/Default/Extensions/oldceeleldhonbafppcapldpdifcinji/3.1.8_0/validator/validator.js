/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
{const t=new URL(window.location.href).searchParams.get("id"),e=document.getElementById("status-box"),a=document.getElementById("status-headline"),s=document.getElementById("status-text"),r=document.getElementById("status-button"),n=document.getElementById("text-field");let o=!1,i=null;function onLTAssistantStateUpdated(t){o||(o=!0,e.setAttribute("data-initialized","true"));const r=t.detail;if(JSON.stringify(r)===JSON.stringify(i))return;i=r;const n=r.validationStatus;e.className="validator__status-box",n===VALIDATION_STATUS.TEXT_TOO_SHORT?(e.classList.add("validator__status-box--no-errors"),a.textContent=i18nManager.getMessage("validatorNoTextStatus"),s.textContent=""):n===VALIDATION_STATUS.TEXT_TOO_LONG?(e.classList.add("validator__status-box--no-errors"),a.textContent=i18nManager.getMessage("validatorTextTooLongStatus"),s.textContent=""):n===VALIDATION_STATUS.IN_PROGRESS?(e.classList.add("validator__status-box--in-progress"),a.textContent=i18nManager.getMessage("validatorLoadingHint"),s.textContent=""):n===VALIDATION_STATUS.COMPLETED?r.errors&&r.errors.length?(e.classList.add("validator__status-box--has-errors"),a.textContent=1===r.errors.length?i18nManager.getMessage("validatorHasMistakesHeadlineSingular"):i18nManager.getMessage("validatorHasMistakesHeadlinePlural",[r.errors.length]),s.textContent=i18nManager.getMessage("validatorHasMistakesText")):r.premiumErrors&&r.premiumErrors.length?(e.classList.add("validator__status-box--has-premium-errors"),a.textContent=1===r.premiumErrors.length?i18nManager.getMessage("validatorHasPremiumErrorsHeadlineSingular"):i18nManager.getMessage("validatorHasPremiumErrorsHeadlinePlural",[r.premiumErrors.length]),s.textContent=i18nManager.getMessage("validatorHasPremiumErrorsText")):(e.classList.add("validator__status-box--no-errors"),a.textContent=i18nManager.getMessage("validatorNoMistakesHeadline"),s.textContent=""):n===VALIDATION_STATUS.UNSUPPORTED_LANGUAGE?(e.classList.add("validator__status-box--has-exception"),a.textContent=i18nManager.getMessage("dialogUnsupportedLanguageHeadline"),s.textContent=i18nManager.getMessage("dialogUnsupportedLanguageText")):n===VALIDATION_STATUS.FAILED&&r.validationErrorMessage?(s.textContent="",a.textContent=r.validationErrorMessage,e.classList.add("validator__status-box--has-exception")):(s.textContent="",a.textContent=i18nManager.getMessage("statusIconError"),e.classList.add("validator__status-box--has-exception"))}function onStatusButtonClick(){if(!i)return;let t="https://languagetoolplus.com/webextension/upgrade?pk_campaign=addon2-validator-premium-errors";t+=`&grammarMatches=${i.premiumErrors.filter(t=>!t.isStyleError).length}`,t+=`&styleMatches=${i.premiumErrors.filter(t=>t.isStyleError).length}`,window.open(t,"_target")}function onBeforeUnload(){localStorage.setItem("validator-text",n.innerText)}if(translateSection(document.documentElement),t){const e={command:"GET_VALIDATOR_DATA",id:t};browser.runtime.sendMessage(e).then(t=>{t&&isGetValidatorDataResult(t)&&(t.text&&(n.innerText=t.text),history.replaceState({},"",location.pathname))}).catch(()=>{Tracker.trackError("js","validator_failed","promise")}).then(()=>{Tracker.trackPageView()})}else n.innerText=localStorage.getItem("validator-text")||"",Tracker.trackPageView();const d=StorageController.create();d.onReady(()=>{d.getUIState().hasPaidSubscription||d.isUsedCustomServer()||document.getElementById("sidebar").classList.remove("validator__sidebar--collapsed"),d.startChangelogCoupon();const t=d.getActiveCoupon();t&&(document.querySelector("#validator-upgrade-button").textContent=i18nManager.getMessage("upgradeTeaserDiscount",[t.percent]))}),n.addEventListener(LTAssistant.events.UPDATE,onLTAssistantStateUpdated),r.addEventListener("click",onStatusButtonClick),window.addEventListener("beforeunload",onBeforeUnload),n.focus()}